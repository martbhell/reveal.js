<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Object Storage Use Cases Part 2: Storing your reveal.js presentation in Object Storage</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<section>
						This slideset is made using <a href="https://github.com/hakimel/reveal.js/" target="_blank">reveal.js</a>.
<br />

You can change slides with the *arrow keys*.
<br />

You can get an overview of all the slides by pressing *esc*.
<br />

Press **↓** to see an index of topics.
<br />
Press **→** one or more times to select topic.

					</section>
					<section data-background="topic_background.png" data-background-size="contain">
						Object Storage Use Cases Part 2: <br />Storing your reveal.js <br /> presentation in Object Storage
					</section>
					<section>

						This is part of a technical series of blog post where the <a href="https://research.csc.fi/cloud-computing" target="_blank">CSC Pouta Cloud Team</a> illustrates with words and sometimes figures how to do things with our <a href="https://research.csc.fi/pouta-object-storage" target="_blank">object storage</a>.

					</section>
					
					<section>
					
						The previous installation in this series was the magnificent <a href="https://pouta.blog.csc.fi/2018/04/object-storage-use-cases-part-1-nfs.html" target="_blank">NFS + ZFS + Encryption blog post</a>
					
					
					</section>
					
					<section>
						Topic for this post: <br />We will experiment with Pouta Object Storage, the <a href="https://aws.amazon.com/cli/" target="_blank">aws tool</a> and reveal.js to upload a presentation at a nice https://mypresentation20180423.object.pouta.csc.fi/index.html URL.
					
					</section>
					
					<section>
					
						At the time of writing, we have not enabled any <a href="https://ceph.com/planet/hosting-a-web-site-in-radosgw/" target="_blank">automatic redirection</a> to index.html with HAProxy if there is no filename specified, so "index.html" is needed or you will see the S3 XML details about the bucket (or AccessDenied). Also https:// at the beginning is needed as we do not yet redirect from TCP 80 to TCP 443.

					</section>
				</section>



				<section>

					<section>
						<h1>Step 1: Configure aws-cli</a>
					</section>
					<section>

		
We need something to easily write files to object storage. We will try the "industry standard" awscli tool to illustrate that it does work even though we are using Ceph's RadosGW which has an S3-like implementation.

					</section>
					<section>


						There are <a href="https://research.csc.fi/pouta-using-object-storage" target="_blank" ="link to our documentation for usage of some clients">many clients</a> one can use with S3. awscli comes with an S3 client inside which is working with our version for Ceph RadosGW (time of writing: Jewel).

					</section>
					<section>

You will need OpenStack ec2 credentials to use S3. You get those with this command:

<pre>
$ openstack ec2 credentials create
</pre>

More instructions about this can be found in <a href="https://research.csc.fi/pouta-install-client" target="_blank">our documentation</a>

					</section>
					<section>


						Setting up a python virtual environment and install awscli inside it (so we don't mess with system libraries):
						
<pre>
$ virtualenv venv_aws
$ source venv_aws/bin/activate
$ pip install -U setuptools # this was needed on my CentOS7 laptop
$ pip install awscli # don't confuse this with "aws" in pip
</pre>

					</section>

                                        <section>

						Configuring it:
						We will use the command "aws configure" to add the ec2 credentials in a format that awscli understands. But before that 
                                                we need to tell the awscli tool to use the signature verification implemented in Ceph RadosGW. We do that by creating and adding the following to $HOME/.aws/credentials

                                        </section>
                                        <section>

(please note the strange syntax for adding the s3 = and signature_version = s3 part. Without the spaces at the beginning of the line with "    signature_version = s3" you will have a bad time:

<pre><code data-noescape>
$ mkdir $HOME/.aws
$ touch $HOME/.aws/credentials
$ chmod 600 $HOME/.aws/credentials
$ chmod 700 $HOME/.aws/
$ $EDITOR $HOME/.aws/credentials
$ cat $HOME/.aws/credentials 
[default]
<mark>
s3 =
    signature_version = s3
</mark>
</code></pre>



                                        </section>


					<section>

Then finally we add the credentials to the file:

<pre>
$ aws configure
AWS Access Key ID [None]: Enteryouraccesskeyidhere
AWS Secret Access Key [None]: Enteryoursecretaccesskeyhere
Default region name [None]: # press ENTER to get the default
Default output format [None]: # press ENTER to get the default
</pre>

					</section>
					<section>

						Now we should be able to use aws cli to upload files to the cPouta Object Storage!
					</section>
					<section>

						Upstream documentation about awscli can be found on <a target="_blank" href="https://aws.amazon.com/cli/">https://aws.amazon.com/cli/</a><br />

					Some useful commands:
					<br /><font size="+2">
					$ aws s3 help
					</font><br />
Create a new bucket:
					<br /><font size="+2">
$ aws s3 mb s3://mynewbucketname
					</font>
					</section>
					<section>
Show some details about an object:
					<br /><font size="+2">
$ aws s3 ls s3://mypresentation20180423/index.html --summarize
<br />
$ aws --endpoint-url https://object.pouta.csc.fi:443 s3 ls s3://mypresentation20180423/index.html --summarize
					</font>
					</section>
					<section>
Copy an object:
					<br /><font size="+2">
$ aws s3 cp $SOURCE $DESTINATION
<br />
$ aws --endpoint-url https://object.pouta.csc.fi:443 s3 cp s3://mypresentation20180423/index.html /tmp/index.html
					</font>
					</section>
					<section>

In Ceph RadosGW Jewel this command does unfortunately not work:

					<br /><font size="+2">
$ aws --endpoint-url https://object.pouta.csc.fi:443 s3 website s3://mypresentation20180423/ --index-document index.html
					</font><br />
					The error: "An error occurred (MethodNotAllowed) when calling the PutBucketWebsite operation: Unknown" <br />
					Our hope is that in luminous this feature will work: <a href="http://docs.ceph.com/docs/luminous/radosgw/bucketpolicy/" target="_blank">http://docs.ceph.com/docs/luminous/radosgw/bucketpolicy/</a>
				

					</section>

				</section>

				<section>

					<section>
						<h1> Step 2: Setup a working directory with of reveal.js </h1>

					</section>
					<section>
After the git client is installed we can clone the reveal.js github repository:

<br />

<pre><code>
$ git clone https://github.com/hakimel/reveal.js.git
$ cd reveal.js
</code></pre>


Inside this directory there is a demo.html and an index.html file that one can use as a base. You could/should modify this to add your content. See some other <a href="https://github.com/hakimel/reveal.js/wiki/Example-Presentations" target="_blank">really cool stuff</a> with reveal.js to personalize your presentation :)


					</section>



				</section>
				<section>
					<section>
	
					<h1> Step 3: Create a bucket in our object storage </h1>
					</section>
					<section>


						We create a bucket with an awesome name:
						<br />
						<font size="+2">$ <font color="green"><b>aws</b></font> --endpoint-url https://object.pouta.csc.fi:443 <font color="green"><b>s3 mb s3://mypresentation20180423</b></font></font>
						<br />


						After the above command one can point a browser to <a href="https://mypresentation20180423.object.pouta.csc.fi" title="opens in a new tab" target="_blank">https://mypresentation20180423.object.pouta.csc.fi</a> ... 

					</section>
					<section>
						... and it will give an <font color="red">AccessDenied</font> error because the bucket is not public. <br />
						This is OK. We don't need the whole bucket public. <br />
						In our upload commands we set the objects as public.<br />

						<br />
						Also note that at the time of writing <a href="https://github.com/aws/aws-cli/issues/1270" target="_blank" title="according to this github issue">one has to</a> specify an --endpoint-url when using aws.
					</section>
				</section>
				<section>

					<section>
						<h1> Step 4: Upload objects to object storage </h1>

					</section>
					<section>

						We sync the contents of our directory with the content in the bucket (except .git/* )and set a public ACL on all the objects. The bucket itself is still private.
						
						This is the same command you would run if you want to update the slides:

						<br />
						<font size="+2">
						$ aws --endpoint-url https://object.pouta.csc.fi:443 s3 sync . s3://mypresentation20180423 --acl public-read --exclude '.git/*'
						</font>
						<br />

The truncated output of the command is:
<pre>
upload: ./Gruntfile.js to s3://mypresentation20180423/Gruntfile.js
upload: css/print/paper.css to s3://mypresentation20180423/css/print/paper.css
upload: ./README.md to s3://mypresentation20180423/README.md      
upload: ./.gitignore to s3://mypresentation20180423/.gitignore    
......
</pre>

					</section>



				</section>
				<section>

				<h1> Step 5: Profit</h1>

And visit <a href="https://mypresentation20180423.object.pouta.csc.fi/index.html" title="this presentation">https://mypresentation20180423.object.pouta.csc.fi/index.html</a>


				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
